# Forkestra - An AI Code Client

## 多 Provider AI 编程助手桌面客户端

整体：Tauri

> 前端技术栈 React + Vite + shadcn/ui + TanStack Router + Zustand + Tailwind CSS + react-icons
> 后端技术栈 git2-rs + tokio + serde

### 核心目标

| 目标 | 描述 |
|------|------|
| **多 Provider 支持** | 统一界面管理 Claude Code、Kimi Code 等（一期先实现这两个） |
| **多 Thread 并行** | 每个会话独立 Git Worktree，无代码冲突 |

### AI Provider

AI Provider 是用于与 已经安装的AI Coding CLI 交互模块。

一期需要实现的：

| Provider | CLI 工具 | 安装方式 |
|----------|----------|----------|
| **Claude Code** | `claude` | `npm install -g @anthropic-ai/claude-code` |
| **Kimi Code** | `kimi` | `npm install -g @anthropic-ai/kimi-cli` |

核心优化点：
1. 自动检测：自动检测用户已安装的AI Coding CLI
2. 支持自定义配置：支持用户自定义AI CLI的path、是否需要鉴权等，就像Claude Code的VSCode扩展一样

## 系统架构设计

### 整体架构图

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                              AI Code Client                                  │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│  ┌─────────────────────────────────────────────────────────────────────┐   │
│  │                        Frontend (React + Vite)                       │   │
│  │  ┌───────────┐ ┌───────────┐ ┌───────────┐ ┌───────────────────┐   │   │
│  │  │  Thread   │ │  Thread   │ │  Thread   │ │    Settings       │   │   │
│  │  │  Tab 1    │ │  Tab 2    │ │  Tab N    │ │    Panel          │   │   │
│  │  │ (Claude)  │ │  (Kimi)   │ │ (Claude)  │ │                   │   │   │
│  │  └─────┬─────┘ └─────┬─────┘ └─────┬─────┘ └───────────────────┘   │   │
│  │        │             │             │                                │   │
│  │  ┌─────┴─────────────┴─────────────┴─────────────────────────────┐ │   │
│  │  │                    Zustand Store                               │ │   │
│  │  │  • sessions[]  • activeSession  • settings  • providers       │ │   │
│  │  └─────────────────────────────────┬─────────────────────────────┘ │   │
│  └────────────────────────────────────┼─────────────────────────────────┘   │
│                                       │ Tauri IPC (invoke)                  │
│  ┌────────────────────────────────────┼─────────────────────────────────┐   │
│  │                     Backend (Tauri + Rust)                           │   │
│  │                                    │                                 │   │
│  │  ┌────────────────┐  ┌─────────────┴───────────┐  ┌──────────────┐  │   │
│  │  │   Worktree     │  │    Session Manager      │  │   Settings   │  │   │
│  │  │   Manager      │  │                         │  │   Manager    │  │   │
│  │  │   (git2-rs)    │  │  ┌─────────────────┐    │  │              │  │   │
│  │  │                │  │  │ Provider Router │    │  │              │  │   │
│  │  │  • create()    │  │  └────────┬────────┘    │  │  • API Keys  │  │   │
│  │  │  • list()      │  │           │             │  │  • Themes    │  │   │
│  │  │  • remove()    │  │  ┌────────┴────────┐    │  │  • Configs   │  │   │
│  │  │  • merge()     │  │  ▼                ▼    │  │              │  │   │
│  │  └────────┬───────┘  │ ┌──────┐    ┌──────┐  │  └──────────────┘  │   │
│  │           │          │ │Claude│    │ Kimi │  │                    │   │
│  │           │          │ │Adapter    │Adapter  │                    │   │
│  │           │          │ └──┬───┘    └──┬───┘  │                    │   │
│  └───────────┼──────────┴────┼───────────┼──────┴────────────────────┘   │
│              │               │           │                               │
└──────────────┼───────────────┼───────────┼───────────────────────────────┘
               │               │           │
               ▼               ▼           ▼
        ┌──────────────┐ ┌──────────┐ ┌──────────┐
        │ Git Repository │ │ claude   │ │  kimi    │
        │ ┌──────────┐  │ │  CLI     │ │  CLI     │
        │ │worktree-1│  │ │ Process  │ │ Process  │
        │ │worktree-2│  │ └──────────┘ └──────────┘
        │ │worktree-N│  │
        │ └──────────┘  │
        └──────────────┘
```

### 数据流设计

```
┌─────────────────────────────────────────────────────────────────┐
│                         User Action                              │
│                    (创建新 Thread / 发送消息)                      │
└───────────────────────────────┬─────────────────────────────────┘
                                │
                                ▼
┌─────────────────────────────────────────────────────────────────┐
│                      React Component                             │
│                   (ThreadPanel / ChatWindow)                     │
└───────────────────────────────┬─────────────────────────────────┘
                                │ dispatch action
                                ▼
┌─────────────────────────────────────────────────────────────────┐
│                       Zustand Store                              │
│              (更新 UI 状态，触发 Tauri 调用)                        │
└───────────────────────────────┬─────────────────────────────────┘
                                │ invoke('create_thread', {...})
                                ▼
┌─────────────────────────────────────────────────────────────────┐
│                    Tauri Command Handler                         │
│                      (Rust Backend)                              │
│                                                                  │
│  1. WorktreeManager.create_session_worktree()                   │
│  2. ProviderAdapter.start_session()                             │
│  3. SessionManager.register_session()                           │
└───────────────────────────────┬─────────────────────────────────┘
                                │ Result<SessionInfo, Error>
                                ▼
┌─────────────────────────────────────────────────────────────────┐
│                       Zustand Store                              │
│                    (更新 sessions 状态)                           │
└───────────────────────────────┬─────────────────────────────────┘
                                │ re-render
                                ▼
┌─────────────────────────────────────────────────────────────────┐
│                      React Component                             │
│                     (显示新 Thread Tab)                          │
└─────────────────────────────────────────────────────────────────┘
```